
//
// Copyright (c) 1992-2020 Wo Of Ideafarm.  All rights reserved.  See IDEAFARM.COM for permitted uses.
//
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 28 years.
// Respecting the rights of other people is an important part of empowering one another.
//


REST

etherC::loafIF( tinP ) ;
etThread.traceF( tinP , T("ok") ) ;

}
    if( bOk ) ;

    countT rc = RtlGenRandom( pbBuffer , sizeof pbBuffer ) ;

    byteT pbBuffer[ TUCK ] ;    
{
if( !bOk )

}
    }
        bOk = 1 ;

        //U::CAPTURE THE GENERATED RANDOM NUMBER HERE

        }
            pop eax
            pop edx

            mov edx , 1

            _emit 0xf0
            _emit 0xc7          // TO USE THIS INSTRUCTION, MUST INSPECT CPUID (?) TO DETERMINE WHETHER RDRAND IS AVAILABLE
            _emit 0x0f          // SEE http://stackoverflow.com/questions/21420219/how-to-get-cryptographically-strong-random-bytes-with-windows-apis/21447428#21447428

            xor  eax , eax
            push edx
            push eax
        {
        __asm
    {
    if( pcName[ 2 ] & ( 1 << 0x1e ) )
    cpuIdAM( 1 , pcName ) ;
{
)
    && pcName[ 3 ] == 0x49656e69
    && pcName[ 2 ] == 0x6c65746e
       pcName[ 1 ] == 0x756e6547
(
if
ZE( boolT , bOk ) ;

cpuIdAM( 0 , pcName ) ;
countT pcName[ 4 ] = { 0 , 0 , 0 , 0 } ;

TODO

;
    modify [ecx edx esi]                                                                                    \
    parm   [eax] [esi]                                                                                      \
                                                                                                            \
    "               mov dword ptr [esi + 0ch] , edx     "                                                   \
    "               mov dword ptr [esi + 08h] , ecx     "                                                   \
    "               mov dword ptr [esi + 04h] , ebx     "                                                   \
    "               mov dword ptr [esi      ] , eax     "                                                   \
    "                                                   "                                                   \
    "               cpuid                               "                                                   \
                                                                                                            \
#pragma aux cpuIdAM =                                                                                       \

#include <ntsecapi.h>

extern "C" BOOLEAN __stdcall   RtlGenRandom( PVOID, ULONG );

// _SystemFunction036@8

#define RtlGenRandom        SystemFunction036

/*1*/WAKEsHOWtEXT( "example.other.inline.assembly.rdrand.instruction" )/*1*/
/**/
*/
/*

//
// Respecting the rights of other people is an important part of empowering one another.
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 28 years.
//
// Copyright (c) 1992-2020 Wo Of Ideafarm.  All rights reserved.  See IDEAFARM.COM for permitted uses.
//

