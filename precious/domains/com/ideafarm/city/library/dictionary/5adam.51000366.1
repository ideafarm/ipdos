
//
// Copyright (c) 1992-2021 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ipdos for permitted uses.
//
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 29 years.
// Respecting the rights of other people is an important part of empowering one another.
//


REST
etThread.osProcessIdPhaseAdamF( tinP , ifcIDpHASEhANDOFFoLD_SHUTTINGdOWN ) ;

#endif

etThread.delF( tinP , pbClick ) ;
etThread.delF( tinP , pbImage ) ;
etThread.delF( tinP , pbFace  ) ;
etThread.delF( tinP , postnu  ) ;

}
    etThread.osSleepF( tinP , TUCK * 0x40 ) ;
    etThread.strokeF( tinP , T("\r")+TF1(etThread.os_cAllKidThreadsI_IF(tinP)-cKidsBefore)+T(" clients are currently being served") ) ;
{
while( etThread.os_cAllKidThreadsI_IF( tinP ) > cKidsBefore )

}
    etThread = 0 ;
    }
        //U: CONJ: LEAK HERE pso
        if( pso && !ether ) { ZE( countT , tid ) ; etThread.osThreadF( tinP , tid , tmServeF , 0 , flTHREADlAUNCH_null , 0 , (countT)pcp , (countT)pso ) ; }
        etThread.strokeF( tinP , T("\r")+TF1(++idClient) ) ;
        sock.acceptF( tinP , pso , idPortPeer , nnPeer , countTC() ) ;
        ZE( countT , idPortPeer ) ;
        nicNameC nnPeer ;
        ZE( socketC* , pso ) ;
    {
    while( !etThread )
    ZE( countT , idClient ) ;
    sock.listenF( tinP ) ;
    sock.bindF( tinP , 8006 ) ;
    socketC sock( tinP , etThread , TAG( TAGiDnULL ) ) ;
{
while( !ether )
const countT cKidsBefore = etThread.os_cAllKidThreadsI_IF( tinP ) ;

const countT pcp[] = { 0 , (countT)postnu , (countT)pbFace , cbFace , (countT)pbImage , cbImage , (countT)pbClick , cbClick , (countT)&cImages , (countT)&cClicks } ;
ZE( countT , cClicks ) ;
ZE( countT , cImages ) ;

etThread.newF( tinP , LF , postnu , COSTnu ) ;
ZE( osTextT* , postnu ) ;

ZE( byteT* , pbClick ) ; ZE( countT , cbClick ) ; etThread.boxGetShadowF( tinP , pbClick , cbClick , T("///ideafarm/ephemeral/domains/com/ideafarm/tmp/7630104/reply.click") ) ; ___( pbClick ) ;
ZE( byteT* , pbImage ) ; ZE( countT , cbImage ) ; etThread.boxGetShadowF( tinP , pbImage , cbImage , T("///ideafarm/ephemeral/domains/com/ideafarm/tmp/7630104/reply.image") ) ; ___( pbImage ) ;
ZE( byteT* , pbFace  ) ; ZE( countT , cbFace  ) ; etThread.boxGetShadowF( tinP , pbFace  , cbFace  , T("///ideafarm/ephemeral/domains/com/ideafarm/tmp/7630104/reply.face" ) ) ; ___( pbFace  ) ;

LAUNCHhEAReNTER( tmHearEnterF , 8006 ) ;

etThread.strokeF( tinP , T("\"Lena\"\r\n\r\nMediaPlex Http Server\r\n\r\npress the Enter key to fire me\r\n\r\n") ) ;

#if defined( NEVERdEFINED )

TODO

DONE( tmServeF )
}
    DEL( pso ) ;
    etThread = 0 ;
    if( !bAbort ) pso->readF( tinP , (osTextT*)pcp[ 1 ] , COSTnu ) ;

    }
        default  : { bAbort = 1                                          ; break ; }
        }
            break ;
            etThread.delF( tinP , postr ) ;
            pso->writeF( tinP , postr , costr ) ;
            countT costr = etThread.strMakeF( tinP , LF , postr , T("HTTP/1.0 200\r\nContent-Type: text/html\r\nContent-Length: ")+TF4(tBody.csF(tinP),flFORMAT_NObASE,0,0xa)+T("\r\n\r\n")+tBody ) ; ___( postr ) ;
            ZE( osTextT* , postr ) ;
            textC tBody = tTitle+TF4(cImages,flFORMAT_NObASE,0xc,0xa)+T("    Impressions (estimate).  This is an estimate of the number of times someone viewed an image in this Datek Campaign.\r\n\r\n")+TF4(cClicks,flFORMAT_NObASE,0xc,0xa)+T("    Clicks.  This is the actual number of times that someone clicked into an image in this Datek Campaign.")+tFooter ;

            ) ;

                "Thank you for selling through the MediaPlex Advertising Network!</pre></html>"
                "\r\n"
                "To obtain assistance, see <A HREF=\"http://www.mediaplex.com\">here</A>!\r\n"
                "To view the MediaPlex Channel Sales Report for this campaign, click <A HREF=\"http://127.0.0.1:8008/r\">here</A>.\r\n"
                "To obtain a current version, click <A HREF=\"http://127.0.0.1:8006/r\">here</A>.\r\n"
                "This report was generated by the MediaPlex, Inc. Advertising Network for Datek Online\r\n"
                "\r\n"
                "\r\n"
                "\r\n"

            TN( tFooter ,

            ) ;

                "\r\n"
                "\r\n"
                "Results Summary:\r\n"
                "\r\n"
                "\r\n"
                "\r\n"
                "\r\n"
                "Description:    ...U:\r\n"
                "\r\n"
                "Scope:          This page reports the results of MediaPlex Campaign #143557.\r\n"
                "\r\n"
                "Short Title:    MediaPlex Channel Advertising Campaign Report: Campaign #143557\r\n"
                "\r\n"
                "\r\n"
                "<html><pre>Datek Online        \"Your tool to invest...\"\r\n"

            TN( tTitle ,

        {
        case 'r' :
        case 'c' : { pso->writeF( tinP , (byteT*)pcp[ 6  ] , pcp[ 7 ] ) ; cClicks ++ ; break ; }
        case 'i' : { pso->writeF( tinP , (byteT*)pcp[ 4  ] , pcp[ 5 ] ) ; cImages ++ ; break ; }
        case 'f' : { pso->writeF( tinP , (byteT*)pcp[ 2  ] , pcp[ 3 ] ) ; break ; }
    {
    switch( postc[ 5 ] )
    ZE( boolT , bAbort ) ;

    pso->readF( tinP , postc , sizeof postc ) ;
    osTextT postc[ 0x6 ] ;

    pso->etherF( tinP , etThread ) ;
    countT&  cClicks = *(countT*)pcp[ 9 ] ;
    countT&  cImages = *(countT*)pcp[ 8 ] ;
    socketC* pso     = (socketC*)pTaskP->c2 ;
    countT*  pcp     = (countT*) pTaskP->c1 ;
{
//if( pTaskP && pTaskP->c1 && pTaskP->c2 )
TASK( tmServeF )

#define COSTnu 0x1000

tmHEAReNTER( tmHearEnterF )

/*1*/WAKEhIDE( "mediaplex.http.server.globe" )/*1*/
/**/
*/
listens to port 8006_9
http server
mediaplex
/*

//
// Respecting the rights of other people is an important part of empowering one another.
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 29 years.
//
// Copyright (c) 1992-2021 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ipdos for permitted uses.
//

