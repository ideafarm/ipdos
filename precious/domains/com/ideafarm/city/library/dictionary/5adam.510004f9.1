
//
// Copyright (c) 1992-2021 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ipdos for permitted uses.
//
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 29 years.
// Respecting the rights of other people is an important part of empowering one another.
//


REST

CONoUTrAW( "after dt of relay; entering REST\r\n" ) ;
}
    CONoUTrAW( "beginning to dt relay\r\n" ) ;
    relayOldC relay( tinP , etThread , bReady ) ;
{

etThread.osThreadF( TaRG1( tmHireF ) , (countT)&bReady ) ;
ZE( boolT , bReady ) ;
etThread.cioSetGetF( tinP , cioGetF ) ;

TODO

DONE( tmHireF )
}
    //U::ENABLE IN PRODUCTION: if( !ether ) etThread.ifcHireF( tinP , T("ifcIDaDAM_KERNEL3BANG") , ifcIDaDAM_KERNEL4iDhOME , T("!ignoreFireByOperator") , flHIRE_DISPLAYaUTO , nicNameC() ) ;
    }
        while( !etThread && !ether && !bReadyP ) { ++ s ; etThread.osSleepF( tinP , TUCK * 0x40 ) ; }
        sleepC s( tinP , TAG( TAGiDnULL ) ) ;
    {
    homeS& home = homeS::homeIF() ;

    boolT& bReadyP = *(boolT*)pTaskP->c1 ;
{
if( pTaskP && pTaskP->c1 )
TASK( tmHireF )

}
    if( cArgP && idptOriginP && bQuitP ) ;

    }
        }
            etherP( tinP , psSecret ) ;
            }
                etherP.delF( tinP , pbKey ) ;
                }
                    etherP.boxPutF( tinP , tLong , pbKey , cbKey ) ;
                    CONoUTrAW( "writing key file\r\n" ) ;

                    TN( tLong , "" ) ; tLong = T("///desk/" POSTfOLDERsECURITYkEYdEPOSITORY)+(idHomeDisk==1?T(""):T(" (Home ")+TF1(idHomeDisk)+T(")"))+T("/")+tShort ;
                    countT idHomeDisk = etherC::ifc_idHomeIdisk_IF() ;
                    textC tShort( tinP , TAG( TAGiDnULL ) , flTEXTc_null , (countT*)pczKeyTopSecret , flFORMAT_UNSIGNED|flFORMAT_FOREIGN|flFORMAT_FILLzE , 8 , 0 , tDot ) ;
                    TN( tDot , "." ) ;
                {
                if( pbKey && cbKey )

                psSecret->shiftRightF( tinP , pbKey , cbKey , ifcIDtYPEsOULiTEM_byteTptr ) ; ___( pbKey ) ;
                ZE( countT , cbKey ) ;
                ZE( byteT* , pbKey ) ;

                *psSecret >> pczKeyTopSecret ;
                ZE( countT* , pczKeyTopSecret ) ;

                etherP.beeClickF( tinP , 1760 * 4 ) ;
            {
            if( psSecret && (countT)*psSecret )
            etherP.cioGetSecretF( tinP , psSecret , *psPayloadP ) ;
            ZE( soulC* , psSecret ) ;
        {
        if( pczChannelP && pczChannelP[ 0 ] == ifcOLDiDcHANNEL1_BYfUNCTION && pczChannelP[ 1 ] == ifcOLDiDcHANNELfUNCTION_MEDIATED && pczChannelP[ 2 ] == ifcIDaDAM_SECRETsERVICE && pczChannelP[ 3 ] == DDNUMB && pczChannelP[ 4 ] == ifcOLDiDcHANNELfUNCTION_SECREThANDsHAKEkEY )
    {
    if( idPayloadTypeP == ifcOLDiDtYPEgIFT_APPLICATION )

    //THREADmODE1rESTORE
    //etherP.strokeF( tinP , TF1(idPayloadTypeP)+T(": ")+T(pczChannelP)+T("\r\n") ) ;
    //THREADmODE1oN( flTHREADmODE1_ALLOWsTOPwHILEgRABBING )
    //U::
{
voidT cioGetF( tinS& tinP , etherC& etherP , const boolT& bQuitP , const countT idPayloadTypeP , soulC*& psPayloadP , countT*& pczChannelP , countT& cArgP , const portTimeC& idptOriginP )

/*1*/WAKEhIDE( "ifcIDaDAM_KERNEL3BANG: simulator code" )/*1*/
/**/
*/
obsoletes df40104
/*

//
// Respecting the rights of other people is an important part of empowering one another.
// This proprietary software was crafted at great expense and with great hardship by one man.  It took 29 years.
//
// Copyright (c) 1992-2021 Wo Of Ideafarm.  All rights reserved.  See https://github.com/ideafarm/ipdos for permitted uses.
//

